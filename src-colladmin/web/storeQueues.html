<html>
  <head>
    <meta charset="utf-8"/>
    <script	src="//ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/themes/smoothness/jquery-ui.css"></link>
    <style type="text/css">
    {{{APITABLE_CSS}}}
    {{{NAVMENU_CSS}}}
    </style>
    <script type="text/javascript">
    {{{COLL_LAMBDABASE_JS}}}
    </script>
    <script type="text/javascript">
    {{{APITABLE_JS}}}
    </script>
    <script type="text/javascript">
    {{{STORAGE_JS}}}
    </script>
    <script src="sorttable.js" type="text/javascript"></script>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <title>Manage Audit Queues and Audit Status</title>
  </head>
  <body>
    {{{NAVMENU}}}
    <div class="form-body">
    <h1>Manage Audit Queues and Audit Status</h1>
    {{{ADMINNAV}}}
    <div class="page-description">
      This page allows the user to reset audit queue items that may have been orphaned during a server restart.
    </div>
    <h3>Audit Queue</h3>
    <div>
      {{#AUDIT_INFO}}
      <table class="sortable results" style="caption-side: bottom">
        <caption>
          <div>
            <caption>
              <button 
                title="Clear Audit Batches Older than 24 hours"
                hours="24"
                class="colladmin storage-clear-audit-batch"
              >Clear Audit Batches Older than 24 hours</button>
              <button 
                title="Clear Audit Batches Older than 2 hours"
                hours="2"
                class="colladmin storage-clear-audit-batch"
              >Clear Audit Batches Older than 2 hours</button>
              <button 
                title="Clear Audit Batches Older than 1 hour"
                hours="1"
                class="colladmin storage-clear-audit-batch"
              >Clear Audit Batches Older than 1 hour</button>
      </caption>
          </div>
        </caption>
        <thead>
          <tr class="header">
            <th>Batch Time</th>
            <th>Count</th>
          </tr>
        </thead>
        <tbody>
          {{#batches}}
          <tr>
            <th>{{batchtime}}</th>
            <td>{{count}}</td>
          </tr>
          {{/batches}}
        </tbody>
      </table>  
      {{/AUDIT_INFO}}
    </div>

    <h3>Audit Statuses</h3>
    <div>
      {{#AUDIT_INFO}}
      <table class="sortable results">
        <thead>
          <tr class="header">
            <th>Status</th>
            <th>Count</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {{#statuses}}
          <tr>
            <th>{{status}}</th>
            <td>{{count}}</td>
            <td>
              {{#reset_allowed}}
              <button 
                title="Retry audits with a status of {{status}}"
                class="colladmin storage-retry-audit-status"
                data-status="{{status}}"
              >Retry Audit Status: {{status}}</button>
              {{/reset_allowed}}   
            </td>
          </tr>
          {{/statuses}}
        </tbody>
      </table>  
      {{/AUDIT_INFO}}

    </div>

  </div>
  </body>
</html>
