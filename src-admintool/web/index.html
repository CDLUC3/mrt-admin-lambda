<html>
  <head>
    <meta charset="utf-8"/>
    <script	src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.css"></link>
    <style type="text/css">
    {{{APITABLE_CSS}}}
    </style>
    <script type="text/javascript">
    {{{LAMBDABASE_JS}}}
    </script>
    <script type="text/javascript">
    {{{APITABLE_JS}}}
    </script>
    <script type="text/javascript">
    {{{DRAWDOWN_JS}}}
    </script>
    <script src="sorttable.js" type="text/javascript"></script>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>            
    <title>AdminTool - Merritt</title>
  </head>
  <body>
    <h1>AdminTool - Merritt</h1>
    <h4 class="report_path"></h4>
    {{{ADMINNAV}}}
    {{{BUTTONS}}}
    <div id="report-description">
    </div>
    <div id="chartdiv">
      <canvas id="myChart"></canvas>
    </div>          
    <div id="menu">

      <h2>Report Index</h2>
      <p><a href="{{ADMINTOOL_BASE}}/web/describeReports.html">Admin Report Descriptions</a></p>
      <p><a href="{{ADMINTOOL_BASE}}/web/navReports.html">Admin Report Descriptions (Nav)</a></p>

      <h2>Applications</h2>
      <ul>
        <li>
          <a class="json" href="{{ADMINTOOL_HOME}}?path=report">Consistency Reports</a>
          <span id="consistency">...</span>
        </li>
        <li><a href="{{COLLADMIN_ADMIN}}">Collection Admin</a></li>
      </ul>

      <h2>Understanding Merritt Content</h2>
      <ul>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=collections">File Counts by Collections</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=owners">File Counts by Owner</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=mimes">Mime Groups</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=filesize">File Size Averages</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=filesizedist&iterate=1">File Size Distribution (Iterative)</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=admin_obj_agg">Merritt Admin Objects Count</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=admin_coll">Collections Table Special Cases</a></li>
      </ul>

      <h2>Campus Invoices</h2>
      <ul>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=invoices&fy=2022">FY2022 Invoices</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=invoices&fy=2021">FY2021 Invoices</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=invoices&fy=2020">FY2020 Invoices</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=invoices&fy=2019">FY2019 Invoices</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=invoices&fy=2019&as_of=2020-01-01">FY2019 Invoices- Proj from Jan 1</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=invoices&fy=2018">FY2018 Invoices</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=invoices&fy=2017">FY2017 Invoices</a></li>
      </ul>

      <h2>Metadata Queries: Objects</h2>
      <ul>
        <li>
          <form action="{{ADMINTOOL_HOME}}">
            Object(s) by Ark:
            <input name="ark" type="text" value="ark:/" size=40 title="Use a % as a wildcard search string"/>
            <input name="path" type="hidden" value="objects_by_ark"/>
            <input type="submit" value="Go!"/>
            <input type="button" onclick="javascript:document.location='ark.html';" value="Multiple Arks"/>
          </form>
        </li>
        <li>
          <form action="{{ADMINTOOL_HOME}}">
            Object(s) by Title:
            <input name="title" type="text" value="" size=40 title="Use a % as a wildcard search string"/>
            <input name="path" type="hidden" value="objects_by_title"/>
            <input type="submit" value="Go!"/>
          </form>
        </li>
        <li>
          <form action="{{ADMINTOOL_HOME}}">
            Object(s) by Author:
            <input name="author" type="text" value="" size=40 title="Use a % as a wildcard search string"/>
            <input name="path" type="hidden" value="objects_by_author"/>
            <input type="submit" value="Go!"/>
          </form>
        </li>
        <li>
          <form action="{{ADMINTOOL_HOME}}">
            Object(s) by Local ID:
            <input name="localid" type="text" value="" size=40 title="Use a % as a wildcard search string"/>
            <input name="path" type="hidden" value="objects_by_local_id"/>
            <input type="submit" value="Go!"/>
            <input type="button" onclick="javascript:document.location='doi.html';" value="Multiple DOIs"/>
            <input type="button" onclick="javascript:document.location='localid.html';" value="Multiple Localids"/>
          </form>
        </li>
      </ul>

      <h2>Metadata Queries: Files</h2>
      <ul>
        <li>
          <form action="{{ADMINTOOL_HOME}}">
            Object(s) by Filename:
            <input name="file" type="text" value="" size=60 title="Use a % as a wildcard search string"/>
            <br/>
            Collection (required for a performant query):
            <input name="mnemonic" type="text" value="cdl_uc3" size=40 />
            <input name="path" type="hidden" value="files_by_name_coll"/>
            <input type="submit" value="Go!"/>
          </form>
        </li>
      </ul>


      <h2>Queries by ingest date</h2>
      <ul>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=collections_by_time_count_producer">Producer Files Added by Date (All time)</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=collections_by_time_count">Files Added by Date (All time)</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=collections_by_time_size">File Size Added by Date (All time)</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=collections_by_time_size_cumulative">Cumulative File Size Added by Date (All time)</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=collections_by_time_count_producer&interval=days">Producer Files Added by Date (Last week)</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=collections_by_time_count&interval=days">Files Added by Date (Last week)</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=collections_by_time_size&interval=days">File Size Added by Date (Last week)</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=collections_by_time_count_producer&interval=weeks">Producer Files Added by Date (Last 4 weeks)</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=collections_by_time_count&interval=weeks">Files Added by Date (Last 4 weeks)</a></li>
        <li><a class="json" href="{{ADMINTOOL_HOME}}?path=collections_by_time_size&interval=weeks">File Size Added by Date (Last 4 weeks)</a></li>
      </ul>

      <h2>Operational Information</h2>
      <ul>
        <li>
          <a href="https://github.com/CDLUC3/mrt-cron/blob/main/consistency-driver/reports.yml">Consistency Report Configuration</a>
        </li>
        <li><a href="{{ADMINTOOL_HOME}}?path=update_billing">Update Billing Database</a></li>
        <li><a href="{{ADMINTOOL_HOME}}?path=update_billing&all-tables=Y">Update Billing Database (recalcuate yesterday's totals)</a></li>
        <li>
          <h3>Audit</h3>
          <ul>
            <li><a href="{{ADMINTOOL_HOME}}?path=audit_status">Audit - Irregular Status</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=audit_status_time&unit=HOUR&count=-1">Audit Status - Last Hour</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=audit_oldest">Audit - Oldest Unprocessed Item</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=audit_size">Audit - Size of Queue</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=audit_processed_size">Historical Audits processed + bytes over time</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=audit_processed_hours&iterate=1">Hourly Audits processed + bytes over time</a></li>
          </ul>
        </li>
        <li>
          <h3>Replication - Objects</h3>
          <ul>
            <li><a href="{{ADMINTOOL_HOME}}?path=replication_needed">Objects - Replication needed</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=replic_processed&iterate=1">Replic processed over time</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=con_objects&copies=1">Objects with <em>1</em> copy (Replication Needed?)</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=con_objects&copies=2">Objects with <em>2</em> copies (Replication Needed?)</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=con_objects&copies=4">Objects with <em>4</em> copies (Cleanup Needed?)</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=con_replic">Outstanding replication</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=replication_initiated">Replication Initiated</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=replication_failed">Replication Failed</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=con_versions">Version Inconsistencies</a></li>
          </ul>
        </li>
        <li>
          <h3>Replication - File View</h3>
          <ul>
            <li><a href="{{ADMINTOOL_HOME}}?path=con_files&copies=1">Files with <em>1</em> copy (Replication Needed?)</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=con_files&copies=2">Files with <em>2</em> copies (Replication Needed?)</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=con_files&copies=4">Files with <em>4</em> copies (Cleanup Needed?)</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=con_no_audit">Files not in the audit table (too slow to run from web)</a></li>
          </ul>
        </li>
        <li>
          <h3>Storage</h3>
          <ul>
            <li><a href="{{ADMINTOOL_HOME}}?path=nodes">Storage Nodes</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=collnodes">Storage Nodes by Collection</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=collection_node_cleanup_required">Storage Node/Collection Cleanup Needed</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=con_primary">Collections with Non-standard Primary Nodes (Not SDSC or Dryad S3)</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=con_secondary">Collections with Non-standard Secondary Nodes (Not Glacier+Wasabi or SDSC+Wasabi)</a></li>
          </ul>
        </li>
        <li>
          <h3>Collections</h3>
          <ul>
            <li><a href="{{ADMINTOOL_HOME}}?path=count_objects">Object Counts by Owner and Collection</a></li>
            <li><a class="json" href="{{ADMINTOOL_HOME}}?path=objects_recent">Recent object updates by collection (object details)</a></li>
          </ul>
        </li>
        <li>
          <h3>Ingests</h3>
          <ul>
            <li><a href="{{ADMINTOOL_HOME}}?path=ingest_bytes_by_hour">Recent Bytes ingested by hour</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=recent_ingests">Recent Ingests</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=big_ingest&items=200&days=14">Big Ingests (200+) - Last 14 days</a></li>
            <li>
              <form action="{{ADMINTOOL_HOME}}">
                Object(s) by Batch Container Name:
                <input name="container" type="text" value="" size=40 title="This would generally be a .checkm or .zip file"/>
                <input name="path" type="hidden" value="objects_by_container_name"/>
                <input type="submit" value="Go!"/>
              </form>
            </li>
          </ul>
        </li>
        <li>
          <h3>Objects</h3>
          <ul>
            <li><a href="{{ADMINTOOL_HOME}}?path=mult_coll&limit=500">Objects linked to more than one collection</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=objects_large">Large Objects</a></li>
            <li><a href="{{ADMINTOOL_HOME}}?path=objects_many_files">Objects with Many Files</a></li>
          </ul>
        </li>
        <li>
          <h3>Local Ids</h3>
          <ul>
            <li><a href="{{ADMINTOOL_HOME}}?path=doi">DOI Ark Conflicts</a></li>
          </ul>
        </li>
      </ul>

    </div>
    <div id="data">
      <div id="alternative">
        <ul style="display: none">
          <li>Alternative URL's go here</li>
        </ul>
      </div>
      <table id="data-table" class="sortable results"/>
    </div>
    <div id="in-progress-container">
      <div id="in-progress">
        <h2>Query in Progress</h2>
        <div id="iprogress">--</div>
      </div>
    </div>
    <script src="sorttable.js" type="text/javascript"></script>
  </body>
</html>
